<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>B·∫£ng gi√°m s√°t ERA</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 8px;
      display: flex;
      justify-content: center;
    }

    .monitor-box {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      padding: 10px 14px;
      width: 600px;
    }

    .monitor-box h2 {
      text-align: center;
      margin: 4px 0 8px 0;
      font-size: 17px;
      color: #333;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px 16px;
    }

    .item {
      display: flex;
      align-items: center;
      font-size: 14px;
    }

    .item span {
      margin-left: 6px;
      flex: 1;
    }

    .warning {
      font-weight: bold;
    }

    .safe { color: green; }
    .fire { color: red; }
    .intruder { color: orange; }
  </style>
</head>
<body>
  <div class="monitor-box">
    <h2>üìä B·∫£ng gi√°m s√°t</h2>

    <div class="grid">
      <div class="item">üå°Ô∏è <span>Nhi·ªát ƒë·ªô: <b id="temperature">--</b> ¬∞C</span></div>
      <div class="item">üíß <span>ƒê·ªô ·∫©m: <b id="humidity">--</b> %</span></div>
      <div class="item">‚è±Ô∏è <span>√Åp su·∫•t: <b id="pressure">--</b> kPa</span></div>
      <div class="item">üå± <span>ƒê·ªô ·∫©m ƒë·∫•t: <b id="soil">--</b> %</span></div>
      <div class="item">üåÄ <span>Ozone: <b id="ozone">--</b> ppm</span></div>
      <div class="item">üî• <span>Kh√≠ gas: <b id="gas" class="warning safe">An to√†n</b></span></div>
      <div class="item">üö∂ <span>Chuy·ªÉn ƒë·ªông: <b id="motion" class="warning safe">Kh√¥ng ph√°t hi·ªán</b></span></div>
    </div>
  </div>

  <!-- ERA Widget -->
  <script src="https://www.unpkg.com/@eohjsc/era-widget@1.1.3/src/index.js"></script>
  <script>
    const eraWidget = new EraWidget();

    const temp = document.getElementById("temperature");
    const humi = document.getElementById("humidity");
    const press = document.getElementById("pressure");
    const soil = document.getElementById("soil");
    const ozone = document.getElementById("ozone");
    const gas = document.getElementById("gas");
    const motion = document.getElementById("motion");

    let configTemp, configHumi, configPress, configSoil, configOzone, configGas, configMotion;

    eraWidget.init({
      onConfiguration: (configuration) => {
        configTemp   = configuration.realtime_configs[0];
        configHumi   = configuration.realtime_configs[1];
        configPress  = configuration.realtime_configs[2];
        configSoil   = configuration.realtime_configs[3];
        configOzone  = configuration.realtime_configs[4];
        configGas    = configuration.realtime_configs[5]; // sensor kh√≠ gas
        configMotion = configuration.realtime_configs[6]; // sensor chuy·ªÉn ƒë·ªông
      },

      onValues: (values) => {
        if (configTemp)   temp.textContent   = values[configTemp.id].value;
        if (configHumi)   humi.textContent   = values[configHumi.id].value;
        if (configPress)  press.textContent  = values[configPress.id].value;
        if (configSoil)   soil.textContent   = values[configSoil.id].value;
        if (configOzone)  ozone.textContent  = values[configOzone.id].value;

        // Ki·ªÉm tra c·∫£nh b√°o kh√≠ gas
        if (configGas) {
          const gasVal = values[configGas.id].value;
          if (gasVal == 1 || gasVal === true || gasVal === "ON" || gasVal === "ALERT") {
            gas.textContent = "Ph√°t hi·ªán kh√≠ gas!";
            gas.className = "warning fire";
          } else {
            gas.textContent = "An to√†n";
            gas.className = "warning safe";
          }
        }

        // Ki·ªÉm tra c·∫£nh b√°o chuy·ªÉn ƒë·ªông
        if (configMotion) {
          const motionVal = values[configMotion.id].value;
          if (motionVal == 1 || motionVal === true || motionVal === "ON" || motionVal === "DETECTED") {
            motion.textContent = "C√≥ ng∆∞∆°ÃÄi!";
            motion.className = "warning intruder";
          } else {
            motion.textContent = "Kh√¥ng ph√°t hi·ªán";
            motion.className = "warning safe";
          }
        }
      },
    });
  </script>
</body>
</html>
